{% extends 'base.html.twig' %}

{% block body %}
    <div class="body-wrapper">
        <div class="photo-panel">
            <div class="photo-panel-position-wrapper">
                <div class="photo-wrapper">
                    <img src="/media/{{ photo.file }}"
                         onmousedown="photoCtrl.onMouseDown(event, this)"
                         ondrag="photoCtrl.onDrag(event, this)"
                         ondragend="photoCtrl.onMouseUp(event, this)"
                         onload="photoCtrl.onLoad()"
                         alt="" />

                    {% for mark in marks %}
                        <div class="rect passive-rect rect-type-{{ mark.element.id }}" style="top: {{ mark.position.top }}%; left: {{ mark.position.left }}%; width: {{ mark.position.width }}%; height: {{ mark.position.height }}%; border-color: {{ mark.element.color }}"></div>
                    {% endfor %}

                    <div class="rect active-rect"></div>
                </div>
            </div>
        </div>
        <div class="action-panel">
            {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                <div style="margin-top: 60px;margin-bottom: 30px;">

                    {% for worldObject in worldObjects %}
                        <a href="{{ path('app.photo', {'uuid': photo.uuid, 'wo': worldObject.id}) }}">{{ worldObject.id }}</a>
                    {% endfor %}

                    {{ form_start(worldObjectForm, {'attr': {'novalidate': 'novalidate'}}) }}
                    {{ form_widget(worldObjectForm.coordinates, {'attr': {'class': 'form-control'}}) }}
                    <button type="submit">Запази</button>
                    {{ form_end(worldObjectForm) }}
                </div>

                {{ form_start(form, {'action': '', 'attr': {'class': 'g-py-15 add-item-form', 'novalidate': 'novalidate'}}) }}

                {% if worldObject.id is defined %}
                {{ form_widget(form.coordinates, {'id': 'coordinates', 'attr': { 'hidden': 'hidden'}}) }}

                <div class="columns">
                    <div class="column is-half">
                        <div class="itemType">
                            <label class="label">Тип на обекта</label>
                            <div class="control has-icons-left">
                                <div class="select">
                                    {{ form_widget(form.element, {'attr': {'class': 'form-control'}}) }}
                                </div>
                                <span class="icon is-small is-left"><i class="fas fa-building"></i></span>
                            </div>
                        </div>
                    </div>
                    <div class="column is-half">
                        <div class="itemCondition">
                            <label class="label">Състояние</label>
                            <div class="control has-icons-left">
                                <div class="select">
                                    {{ form_widget(form.condition, {'attr': {'class': 'form-control'}}) }}
                                </div>
                                <span class="icon is-small is-left"><i class="fas fa-highlighter"></i></span>
                            </div>
                        </div>
                    </div>
                </div>

                {#<button type="submit">test</button>#}
                <a class="button is-warning mtb10"
                   id="submit-button"
                   onclick="photoCtrl.addItem()"
                   disabled>Добави</a>
                <a class="button is-light mtb10"
                   id="clear-button"
                   style="display: none"
                   onclick="photoCtrl.clearSelection()">Изчисти</a>

                {{ form_end(form) }}

                <hr />
            {% endif %}

            <aside class="menu items" style="margin-top: 24px;">
                <p class="menu-label">Отбелязани обекти</p>
                <ul class="menu-list">
                    {% for element in markedElements %}
                        {% if elementsCount[element.id] is defined %}
                            <li id="item-{{ element.id }}"
                                onmouseover="rectCtrl.showPassiveRects({{ element.id }})"
                                onmouseleave="rectCtrl.hidePassiveRects({{ element.id }})">
                                <a>
                                    <span class="tag item-color-mark" style="color: {{ element.color }};">&bull;</span>
                                    {{ element.name }}
                                    <span class="tag is-light"> {{ element.count }} </span>
                                    {% if areas[element.id] is defined and areas[element.id] is not empty %}
                                        <span class="is-light">(площ {{ areas[element.id] }}%)</span>
                                    {% endif %}
                                </a>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <a class="button is-text"
                   onmouseover="rectCtrl.showAllPassiveRects()"
                   onmouseleave="rectCtrl.hideAllPassiveRects()">Покажи всички</a>

            </aside>
            {% endif %}

        </div>
    </div>
{% endblock %}
